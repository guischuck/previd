import{r as n,x as re,j as e,Q as ae,t as N,S as oe}from"./app-BLxXbY_b.js";import{B as M}from"./badge-Dyb6KrPA.js";import{a as ne,B as i}from"./button-DT3cAopr.js";import{C as p,b as u,c as x,a as h,d as S}from"./card-DXsYbZZ8.js";import{C as ie}from"./checkbox-gA__v4D3.js";import{L as ce}from"./label-DhHCYi2m.js";import{P as le}from"./progress-D5ZrSgqH.js";import{S as de,a as me,b as pe,c as ue,d as xe}from"./select-PIBy2OK5.js";import{T as he}from"./textarea-B3ufgyOM.js";import{A as fe,U as ge,F as je,X as ye,C as ve}from"./app-layout-G5Onjp1f.js";import{A as Ne}from"./arrow-left-DkkcmHkS.js";import{S as be}from"./square-pen-D9lBJ853.js";import{C as we}from"./index-CpqCA5-U.js";import{U as Se}from"./upload-BMeS_ONa.js";import{D as Ce}from"./download-Du89vd0F.js";import{C as Te}from"./circle-alert-4k1SCI3A.js";/* empty css            */import"./index-6jQRo-49.js";import"./index-Ci0KITsv.js";import"./chevron-up-B9Jrt4ee.js";import"./app-logo-icon-DgzmCoEH.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],X=ne("Circle",Ee);function Qe({case:r,users:De,benefitTypes:C}){const[m,b]=n.useState(()=>{const s=r.tasks;return s&&Array.isArray(s)?s.map(t=>({id:t.id.toString(),title:t.title,description:t.description||"",completed:t.status==="completed",priority:t.priority,required_documents:t.required_documents||[],order:t.order||0,status:t.status,due_date:t.due_date,assigned_to:t.assigned_to})):[]}),[T,E]=n.useState([]),[k,F]=n.useState(!1),[D,A]=n.useState(!1),[R,z]=n.useState(!1),[P,B]=n.useState(!1),[f,g]=n.useState(!1),L=n.useRef(null),{data:c,setData:O,patch:H}=re({notes:r.notes||"",benefit_type:r.benefit_type||""}),K=[{title:"Dashboard",href:"/dashboard"},{title:"Casos",href:"/cases"},{title:r.case_number,href:`/cases/${r.id}`}],J=s=>{switch(s){case"pending":return"bg-yellow-100 text-yellow-800";case"analysis":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";case"requirement":return"bg-orange-100 text-orange-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},G=s=>s?new Date(s).toLocaleDateString("pt-BR"):"Não informado";n.useEffect(()=>{q(),j()},[]),n.useEffect(()=>{c.benefit_type&&j()},[c.benefit_type]);const q=async()=>{try{const s=await fetch(`/api/cases/${r.id}/documents`);if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const t=await s.json();t.success&&t.documents?E(t.documents):(console.error("Erro na resposta da API:",t.error||"Resposta inválida"),E([]))}catch(s){console.error("Erro ao carregar documentos:",s),E([])}},j=async()=>{g(!0);try{const s=await fetch(`/api/cases/${r.id}/tasks`,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"include"});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const t=await s.json();if(t.success&&t.tasks){const a=t.tasks.map(o=>({id:o.id.toString(),title:o.title,description:o.description||"",completed:o.status==="completed",priority:o.priority,required_documents:o.required_documents||[],order:o.order||0,status:o.status,due_date:o.due_date,assigned_to:o.assigned_to}));b(a),console.log(`✅ ${a.length} tarefas carregadas com sucesso`)}else console.error("Erro na resposta da API de tarefas:",t.error||"Resposta inválida"),b([])}catch(s){console.error("Erro ao carregar tarefas:",s),b([])}finally{g(!1)}},Q=async s=>{var t;try{const a=m.find(_=>_.id===s);if(!a)return;const o=a.completed?"pending":"completed",d=(t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content");if((await fetch(`/api/tasks/${s}`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":d||""},body:JSON.stringify({status:o,completed_at:o==="completed"?new Date().toISOString():null})})).ok){const _=m.map(w=>w.id===s?{...w,completed:!w.completed,status:o}:w);b(_)}}catch(a){console.error("Erro ao atualizar tarefa:",a)}},W=async()=>{var s;z(!0);try{const t=(s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"),a=await fetch(`/api/cases/${r.id}/notes`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t||""},body:JSON.stringify({notes:c.notes})});if(a.ok){const o=await a.json();B(!0),setTimeout(()=>B(!1),3e3),console.log(o.message)}else console.error("Erro ao salvar anotações"),alert("Erro ao salvar anotações. Tente novamente.")}catch(t){console.error("Erro ao salvar anotações:",t)}finally{z(!1)}},$=s=>{s.preventDefault(),s.stopPropagation(),s.type==="dragenter"||s.type==="dragover"?A(!0):s.type==="dragleave"&&A(!1)},Y=s=>{s.preventDefault(),s.stopPropagation(),A(!1),s.dataTransfer.files&&s.dataTransfer.files[0]&&I(s.dataTransfer.files)},Z=s=>{s.preventDefault(),s.target.files&&s.target.files[0]&&I(s.target.files)},I=async s=>{var t;F(!0);try{const a=new FormData;Array.from(s).forEach(v=>{a.append("files[]",v)}),a.append("type","other"),a.append("notes","Enviado via interface do caso");const o=(t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"),d=await fetch(`/api/cases/${r.id}/upload-documents`,{method:"POST",headers:{"X-CSRF-TOKEN":o||""},body:a});if(d.ok){const v=await d.json();q(),oe.visit(`/cases/${r.id}`,{preserveState:!0,preserveScroll:!0,only:["flash"]})}else console.error("Erro no upload")}catch(a){console.error("Erro ao fazer upload:",a)}finally{F(!1)}},ee=async s=>{var t;if(confirm("Tem certeza que deseja excluir este documento?"))try{const a=(t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content");(await fetch(`/api/documents/${s}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":a||""}})).ok&&q()}catch(a){console.error("Erro ao deletar documento:",a)}},se=s=>{if(s===0)return"0 Bytes";const t=1024,a=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,o)).toFixed(2))+" "+a[o]},[y,U]=n.useState(r.collection_progress||{percentage:0,completed:0,total:r.employment_relationships.length,status:"Sem vínculos"}),[l,V]=n.useState(r.status);n.useEffect(()=>{const s=a=>{const{caseId:o,progress:d,status:v}=a.detail;o===r.id&&(console.log("Atualizando progresso em tempo real:",d),U(d),V(v))};window.addEventListener("caseProgressUpdated",s);const t=localStorage.getItem(`case_progress_${r.id}`);if(t)try{const a=JSON.parse(t);Date.now()-a.timestamp<5*60*1e3&&(U(a.progress),V(a.status))}catch(a){console.error("Erro ao parsear dados do localStorage:",a)}return r.benefit_type&&m.length===0&&(console.log("Carregando tarefas automaticamente para benefit_type:",r.benefit_type),j()),()=>{window.removeEventListener("caseProgressUpdated",s)}},[r.id,r.benefit_type]);const te=s=>{switch(s){case"high":return e.jsx(Te,{className:"h-4 w-4 text-red-500"});case"medium":return e.jsx(ve,{className:"h-4 w-4 text-yellow-500"});case"low":return e.jsx(X,{className:"h-4 w-4 text-gray-400"});default:return e.jsx(X,{className:"h-4 w-4 text-gray-400"})}};return e.jsxs(fe,{breadcrumbs:K,children:[e.jsx(ae,{title:`Caso ${r.case_number} - Sistema Jurídico`}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center space-x-4",children:e.jsx(N,{href:"/cases",children:e.jsxs(i,{variant:"outline",size:"sm",children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Voltar aos Casos"]})})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{href:`/cases/${r.id}/vinculos`,children:e.jsxs(i,{variant:"outline",children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),"Vínculos (",r.employment_relationships.length,")"]})}),e.jsx(N,{href:`/cases/${r.id}/edit`,children:e.jsxs(i,{children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),"Editar Caso"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:[e.jsxs("div",{className:"space-y-6 lg:col-span-2",children:[e.jsxs(p,{children:[e.jsx(u,{children:e.jsxs(x,{className:"flex items-center space-x-2",children:[e.jsx(je,{className:"h-5 w-5"}),e.jsx("span",{children:"Informações do Caso"})]})}),e.jsx(h,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Número do Caso"}),e.jsx("p",{className:"font-mono text-lg",children:r.case_number})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Status"}),e.jsx(M,{className:J(l),children:l==="pendente"?"Pendente":l==="em_coleta"?"Em Coleta":l==="aguarda_peticao"?"Aguarda Petição":l==="protocolado"?"Protocolado":l==="concluido"?"Concluído":l==="rejeitado"?"Rejeitado":l})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Nome do Cliente"}),e.jsx("p",{className:"text-lg",children:r.client_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"CPF"}),e.jsx("p",{className:"text-lg",children:r.client_cpf})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Tipo de Benefício"}),e.jsx("p",{className:"text-lg",children:r.benefit_type?C[r.benefit_type]||r.benefit_type:"Não informado"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Criado em"}),e.jsx("p",{className:"text-lg",children:G(r.created_at)})]})]})})]}),e.jsxs(p,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs("div",{children:[e.jsx(x,{children:"Workflow de Tarefas"}),e.jsx(S,{children:"Tarefas recomendadas para o tipo de benefício selecionado"})]}),e.jsx(i,{variant:"outline",size:"sm",onClick:j,disabled:f,className:"shrink-0",children:f?"⏳ Carregando...":"🔄 Recarregar"})]}),e.jsx(h,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(ce,{htmlFor:"benefit_type",children:"Tipo de Benefício"}),e.jsxs(de,{value:c.benefit_type||"",onValueChange:async s=>{if(O("benefit_type",s||""),!!s){console.log("Tipo de benefício selecionado:",s),g(!0);try{await H(`/cases/${r.id}`,{preserveScroll:!0,onSuccess:()=>{console.log("Tipo de benefício salvo, carregando tarefas..."),setTimeout(()=>{j()},1e3)},onError:t=>{console.error("Erro ao atualizar caso:",t),g(!1)}})}catch(t){console.error("Erro ao salvar tipo de benefício:",t),g(!1)}}},children:[e.jsx(me,{children:e.jsx(pe,{placeholder:"Selecione o tipo de benefício"})}),e.jsx(ue,{children:Object.entries(C).map(([s,t])=>e.jsx(xe,{value:s,children:t},s))})]})]}),f&&e.jsx("div",{className:"py-8 text-center text-blue-600",children:e.jsxs("div",{className:"inline-flex items-center space-x-2",children:[e.jsx("div",{className:"h-5 w-5 animate-spin rounded-full border-2 border-blue-600 border-t-transparent"}),e.jsx("span",{children:"Carregando tarefas..."})]})}),c.benefit_type&&m.length>0&&!f&&e.jsx("div",{className:"space-y-3",children:m.map(s=>e.jsxs("div",{className:"flex items-start space-x-3 rounded-lg border bg-card p-4 shadow-sm",children:[e.jsx(ie,{checked:s.completed,onCheckedChange:()=>Q(s.id)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[te(s.priority),e.jsx("h4",{className:`font-medium ${s.completed?"text-muted-foreground line-through":""}`,children:s.title})]}),e.jsx("p",{className:`mt-1 text-sm text-muted-foreground ${s.completed?"line-through":""}`,children:s.description}),s.required_documents&&s.required_documents.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"mb-1 text-xs font-medium text-muted-foreground",children:"Documentos necessários:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.required_documents.map((t,a)=>e.jsx(M,{variant:"secondary",className:"flex items-center",children:t},a))})]})]})]},s.id))}),c.benefit_type&&m.length===0&&!f&&e.jsxs("div",{className:"py-8 text-center text-gray-500",children:[e.jsx("p",{children:"Nenhuma tarefa de workflow encontrada para este tipo de benefício."}),e.jsxs("p",{className:"mt-1 text-sm",children:['Verifique se existe um template ativo para "',C[c.benefit_type]||c.benefit_type,'".']})]})]})})]}),e.jsxs(p,{children:[e.jsxs(u,{children:[e.jsx(x,{children:"Anotações sobre o Caso"}),e.jsx(S,{children:"Adicione observações e notas importantes sobre o caso"})]}),e.jsx(h,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(he,{value:c.notes,onChange:s=>O("notes",s.target.value),placeholder:"Digite suas anotações sobre o caso...",rows:4}),e.jsx(i,{onClick:W,disabled:R,variant:"default",className:P?"bg-green-600 text-white hover:bg-green-700":"",children:R?"Salvando...":P?e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Salvo!"]}):"Salvar Anotações"})]})})]}),r.description&&e.jsxs(p,{children:[e.jsx(u,{children:e.jsx(x,{children:"Descrição"})}),e.jsx(h,{children:e.jsx("p",{className:"whitespace-pre-wrap",children:r.description})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(p,{children:[e.jsxs(u,{children:[e.jsx(x,{children:"Progresso da Coleta"}),e.jsx(S,{children:"Vínculos empregatícios coletados"})]}),e.jsx(h,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Progresso"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[y.completed,"/",y.total]})]}),e.jsx(le,{value:y.percentage,className:"w-full"}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[Math.round(y.percentage),"%"]}),e.jsx("p",{className:"text-sm text-gray-600",children:y.status})]}),e.jsx(N,{href:`/cases/${r.id}/vinculos`,children:e.jsx(i,{variant:"outline",size:"sm",className:"w-full",children:"Gerenciar Vínculos"})})]})})]}),e.jsxs(p,{children:[e.jsxs(u,{children:[e.jsxs(x,{children:["Documentos (",T.length,")"]}),e.jsx(S,{children:"Faça upload de documentos relacionados ao caso"})]}),e.jsx(h,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:`rounded-lg border-2 border-dashed p-6 text-center transition-colors ${D?"border-blue-400 bg-blue-50":"border-gray-300 hover:border-gray-400"}`,onDragEnter:$,onDragLeave:$,onDragOver:$,onDrop:Y,children:[e.jsx("input",{ref:L,type:"file",multiple:!0,onChange:Z,className:"hidden",accept:".pdf,.doc,.docx,.jpg,.jpeg,.png"}),e.jsx(Se,{className:`mx-auto mb-2 h-8 w-8 ${D?"text-blue-500":"text-gray-400"}`}),e.jsx("p",{className:"mb-2 text-sm text-gray-600",children:D?"Solte os arquivos aqui":"Arraste e solte arquivos aqui ou clique para selecionar"}),e.jsx(i,{variant:"outline",onClick:()=>{var s;return(s=L.current)==null?void 0:s.click()},disabled:k,children:k?"Enviando...":"Selecionar Arquivos"})]}),T.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Documentos Enviados:"}),T.map(s=>e.jsxs("div",{className:"flex items-center justify-between rounded border p-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:s.file_name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[se(s.file_size)," • ",new Date(s.created_at).toLocaleDateString("pt-BR")]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>window.open(`/documents/${s.id}/download`,"_blank"),children:e.jsx(Ce,{className:"h-4 w-4"})}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>ee(s.id),className:"text-red-500 hover:text-red-700",children:e.jsx(ye,{className:"h-4 w-4"})})]})]},s.id))]}),e.jsx(N,{href:`/documents/case/${r.id}`,children:e.jsx(i,{variant:"outline",className:"w-full",children:"Ver Todos os Documentos"})})]})})]})]})]})]})]})}export{Qe as default};
