import{r as i,x as te,j as e,Q as re,t as b,S as ae}from"./app-D2IawdKC.js";import{B as M}from"./badge-BhH6_4yY.js";import{a as oe,B as c}from"./button-DNBkhuBo.js";import{C as x,b as f,c as h,a as g,d as C}from"./card-iaGQ1KdM.js";import{C as ne}from"./checkbox-BQofz_Oq.js";import{L as ie}from"./label-DqtjYQjL.js";import{P as ce}from"./progress-ByO0EAG3.js";import{S as le,a as de,b as me,c as pe,d as ue}from"./select-BKNin1bN.js";import{T as xe}from"./textarea-fgDGdbTO.js";import{A as fe,U as he,F as ge,X as je,C as ye}from"./app-layout-BYyG2lHs.js";import{A as Ne}from"./arrow-left-BOJvmNQQ.js";import{S as ve}from"./square-pen-CoQLwFMc.js";import{C as be}from"./index-AmfJO-1_.js";import{U as we}from"./upload-YzZpNiwr.js";import{D as Se}from"./download-Cw2kvsUJ.js";import{C as Ce}from"./circle-alert-BmBlAQoU.js";/* empty css            */import"./index-ClnT_KFv.js";import"./index-DUQrCSJ5.js";import"./chevron-up-uakZWWTG.js";import"./app-logo-icon-DX44ml0d.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],U=oe("Circle",Te);function Ge({case:a,users:Ee,benefitTypes:T}){const[p,j]=i.useState(()=>{const s=a.tasks;return s&&Array.isArray(s)?s.map(t=>({id:t.id.toString(),title:t.title,description:t.description||"",completed:t.status==="completed",priority:t.priority,required_documents:t.required_documents||[],order:t.order||0,status:t.status,due_date:t.due_date,assigned_to:t.assigned_to})):[]}),[E,D]=i.useState([]),[F,_]=i.useState(!1),[A,P]=i.useState(!1),[k,z]=i.useState(!1),[q,L]=i.useState(!1),[y,w]=i.useState(!1),O=i.useRef(null),{data:d,setData:B}=te({notes:a.notes||"",benefit_type:a.benefit_type||""}),V=[{title:"Dashboard",href:"/dashboard"},{title:"Casos",href:"/cases"},{title:a.case_number,href:`/cases/${a.id}`}],K=s=>{switch(s){case"pending":return"bg-yellow-100 text-yellow-800";case"analysis":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";case"requirement":return"bg-orange-100 text-orange-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},J=s=>s?new Date(s).toLocaleDateString("pt-BR"):"Não informado";i.useEffect(()=>{$()},[]),i.useEffect(()=>{a.benefit_type?(console.log("Carregando tarefas para o benefício:",a.benefit_type),N()):(console.log("Nenhum tipo de benefício definido. Aguardando seleção..."),j([]))},[a.benefit_type]),i.useEffect(()=>{a.benefit_type&&(console.log("Carregando tarefas iniciais para o benefício:",a.benefit_type),N())},[]);const $=async()=>{try{const s=await fetch(`/api/cases/${a.id}/documents`);if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const t=await s.json();t.success&&t.documents?D(t.documents):(console.error("Erro na resposta da API:",t.error||"Resposta inválida"),D([]))}catch(s){console.error("Erro ao carregar documentos:",s),D([])}},N=async()=>{var s;console.log("Iniciando carregamento de tarefas para o caso:",a.id),w(!0);try{const t=await fetch(`/cases/${a.id}/tasks`,{method:"GET",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"))||""},credentials:"same-origin"});if(console.log("Resposta da API de tarefas - Status:",t.status),!t.ok){const n=await t.text();throw console.error("Erro na resposta da API de tarefas:",n),new Error(`HTTP error! status: ${t.status}, response: ${n}`)}const r=await t.json();if(console.log("Dados retornados pela API de tarefas:",r),r.success&&Array.isArray(r.tasks)){const n=r.tasks.map(o=>(console.log("Processando tarefa:",o),{id:o.id.toString(),title:o.title,description:o.description||"",completed:o.status==="completed",priority:o.priority||"medium",required_documents:o.required_documents||[],order:o.order||0,status:o.status||"pending",due_date:o.due_date,assigned_to:o.assigned_to}));console.log(`✅ ${n.length} tarefas formatadas:`,n),j(n)}else console.error("Formato inesperado na resposta da API de tarefas:",r),j([])}catch(t){console.error("Erro ao carregar tarefas:",t),j([])}finally{w(!1)}},G=async s=>{var t;try{const r=p.find(u=>u.id===s);if(!r)return;const n=r.completed?"pending":"completed",o=(t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content");if((await fetch(`/api/tasks/${s}`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":o||""},body:JSON.stringify({status:n,completed_at:n==="completed"?new Date().toISOString():null})})).ok){const u=p.map(S=>S.id===s?{...S,completed:!S.completed,status:n}:S);j(u)}}catch(r){console.error("Erro ao atualizar tarefa:",r)}},W=async()=>{var s;z(!0);try{const t=(s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"),r=await fetch(`/api/cases/${a.id}/notes`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t||""},body:JSON.stringify({notes:d.notes})});if(r.ok){const n=await r.json();L(!0),setTimeout(()=>L(!1),3e3),console.log(n.message)}else console.error("Erro ao salvar anotações"),alert("Erro ao salvar anotações. Tente novamente.")}catch(t){console.error("Erro ao salvar anotações:",t)}finally{z(!1)}},R=s=>{s.preventDefault(),s.stopPropagation(),s.type==="dragenter"||s.type==="dragover"?P(!0):s.type==="dragleave"&&P(!1)},Q=s=>{s.preventDefault(),s.stopPropagation(),P(!1),s.dataTransfer.files&&s.dataTransfer.files[0]&&I(s.dataTransfer.files)},Y=s=>{s.preventDefault(),s.target.files&&s.target.files[0]&&I(s.target.files)},I=async s=>{var t;_(!0);try{const r=new FormData;Array.from(s).forEach(m=>{r.append("files[]",m)}),r.append("type","other"),r.append("notes","Enviado via interface do caso");const n=(t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"),o=await fetch(`/api/cases/${a.id}/upload-documents`,{method:"POST",headers:{"X-CSRF-TOKEN":n||""},body:r});if(o.ok){const m=await o.json();$(),ae.visit(`/cases/${a.id}`,{preserveState:!0,preserveScroll:!0,only:["flash"]})}else console.error("Erro no upload")}catch(r){console.error("Erro ao fazer upload:",r)}finally{_(!1)}},Z=async s=>{var t;if(confirm("Tem certeza que deseja excluir este documento?"))try{const r=(t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content");(await fetch(`/api/documents/${s}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":r||""}})).ok&&$()}catch(r){console.error("Erro ao deletar documento:",r)}},ee=s=>{if(s===0)return"0 Bytes";const t=1024,r=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,n)).toFixed(2))+" "+r[n]},[v,X]=i.useState(a.collection_progress||{percentage:0,completed:0,total:a.employment_relationships.length,status:"Sem vínculos"}),[l,H]=i.useState(a.status);i.useEffect(()=>{const s=r=>{const{caseId:n,progress:o,status:m}=r.detail;n===a.id&&(console.log("Atualizando progresso em tempo real:",o),X(o),H(m))};window.addEventListener("caseProgressUpdated",s);const t=localStorage.getItem(`case_progress_${a.id}`);if(t)try{const r=JSON.parse(t);Date.now()-r.timestamp<5*60*1e3&&(X(r.progress),H(r.status))}catch(r){console.error("Erro ao parsear dados do localStorage:",r)}return a.benefit_type&&p.length===0&&(console.log("Carregando tarefas automaticamente para benefit_type:",a.benefit_type),N()),()=>{window.removeEventListener("caseProgressUpdated",s)}},[a.id,a.benefit_type]);const se=s=>{switch(s){case"high":return e.jsx(Ce,{className:"h-4 w-4 text-red-500"});case"medium":return e.jsx(ye,{className:"h-4 w-4 text-yellow-500"});case"low":return e.jsx(U,{className:"h-4 w-4 text-gray-400"});default:return e.jsx(U,{className:"h-4 w-4 text-gray-400"})}};return e.jsxs(fe,{breadcrumbs:V,children:[e.jsx(re,{title:`Caso ${a.case_number} - Sistema Jurídico`}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center space-x-4",children:e.jsx(b,{href:"/cases",children:e.jsxs(c,{variant:"outline",size:"sm",children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Voltar aos Casos"]})})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(b,{href:`/cases/${a.id}/vinculos`,children:e.jsxs(c,{variant:"outline",children:[e.jsx(he,{className:"mr-2 h-4 w-4"}),"Vínculos (",a.employment_relationships.length,")"]})}),e.jsx(b,{href:`/cases/${a.id}/edit`,children:e.jsxs(c,{children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Editar Caso"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:[e.jsxs("div",{className:"space-y-6 lg:col-span-2",children:[e.jsxs(x,{children:[e.jsx(f,{children:e.jsxs(h,{className:"flex items-center space-x-2",children:[e.jsx(ge,{className:"h-5 w-5"}),e.jsx("span",{children:"Informações do Caso"})]})}),e.jsx(g,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Número do Caso"}),e.jsx("p",{className:"font-mono text-lg",children:a.case_number})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Status"}),e.jsx(M,{className:K(l),children:l==="pendente"?"Pendente":l==="em_coleta"?"Em Coleta":l==="aguarda_peticao"?"Aguarda Petição":l==="protocolado"?"Protocolado":l==="concluido"?"Concluído":l==="rejeitado"?"Rejeitado":l})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Nome do Cliente"}),e.jsx("p",{className:"text-lg",children:a.client_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"CPF"}),e.jsx("p",{className:"text-lg",children:a.client_cpf})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Tipo de Benefício"}),e.jsx("p",{className:"text-lg",children:a.benefit_type?T[a.benefit_type]||a.benefit_type:"Não informado"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Criado em"}),e.jsx("p",{className:"text-lg",children:J(a.created_at)})]})]})})]}),e.jsxs(x,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs("div",{children:[e.jsx(h,{children:"Workflow de Tarefas"}),e.jsx(C,{children:"Tarefas recomendadas para o tipo de benefício selecionado"})]}),e.jsx(c,{variant:"outline",size:"sm",onClick:N,disabled:y,className:"shrink-0",children:y?"⏳ Carregando...":"🔄 Recarregar"})]}),e.jsx(g,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(ie,{htmlFor:"benefit_type",children:"Tipo de Benefício"}),e.jsxs(le,{value:d.benefit_type||"",onValueChange:async s=>{var t;console.log("Tipo de benefício selecionado:",s),w(!0);try{const r=new FormData;r.append("benefit_type",s||""),r.append("_method","PATCH");const n=((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"))||"";console.log("Enviando requisição com benefit_type:",s||"(vazio)");const o=await fetch(`/cases/${a.id}`,{method:"POST",headers:{"X-CSRF-TOKEN":n,Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-Inertia":"true"},body:r});if(!o.ok){const u=await o.text();throw console.error("Erro na resposta do servidor:",o.status,u),new Error(`Erro ao atualizar o caso: ${o.status} ${u}`)}const m=await o.json();console.log("Resposta do servidor:",m),B("benefit_type",s||""),setTimeout(()=>{N()},500)}catch(r){console.error("Erro ao atualizar o caso:",r),w(!1)}},children:[e.jsx(de,{children:e.jsx(me,{placeholder:"Selecione o tipo de benefício"})}),e.jsx(pe,{children:Object.entries(T).map(([s,t])=>e.jsx(ue,{value:s,children:t},s))})]})]}),y&&e.jsx("div",{className:"py-8 text-center text-blue-600",children:e.jsxs("div",{className:"inline-flex items-center space-x-2",children:[e.jsx("div",{className:"h-5 w-5 animate-spin rounded-full border-2 border-blue-600 border-t-transparent"}),e.jsx("span",{children:"Carregando tarefas..."})]})}),d.benefit_type&&p.length>0&&!y&&e.jsx("div",{className:"space-y-3",children:p.map(s=>e.jsxs("div",{className:"flex items-start space-x-3 rounded-lg border bg-card p-4 shadow-sm",children:[e.jsx(ne,{checked:s.completed,onCheckedChange:()=>G(s.id)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[se(s.priority),e.jsx("h4",{className:`font-medium ${s.completed?"text-muted-foreground line-through":""}`,children:s.title})]}),e.jsx("p",{className:`mt-1 text-sm text-muted-foreground ${s.completed?"line-through":""}`,children:s.description}),s.required_documents&&s.required_documents.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"mb-1 text-xs font-medium text-muted-foreground",children:"Documentos necessários:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.required_documents.map((t,r)=>e.jsx(M,{variant:"secondary",className:"flex items-center",children:t},r))})]})]})]},s.id))}),d.benefit_type&&p.length===0&&!y&&e.jsxs("div",{className:"py-8 text-center text-gray-500",children:[e.jsx("p",{children:"Nenhuma tarefa de workflow encontrada para este tipo de benefício."}),e.jsxs("p",{className:"mt-1 text-sm",children:['Verifique se existe um template ativo para "',T[d.benefit_type]||d.benefit_type,'".']})]})]})})]}),e.jsxs(x,{children:[e.jsxs(f,{children:[e.jsx(h,{children:"Anotações sobre o Caso"}),e.jsx(C,{children:"Adicione observações e notas importantes sobre o caso"})]}),e.jsx(g,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(xe,{value:d.notes,onChange:s=>B("notes",s.target.value),placeholder:"Digite suas anotações sobre o caso...",rows:4}),e.jsx(c,{onClick:W,disabled:k,variant:"default",className:q?"bg-green-600 text-white hover:bg-green-700":"",children:k?"Salvando...":q?e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),"Salvo!"]}):"Salvar Anotações"})]})})]}),a.description&&e.jsxs(x,{children:[e.jsx(f,{children:e.jsx(h,{children:"Descrição"})}),e.jsx(g,{children:e.jsx("p",{className:"whitespace-pre-wrap",children:a.description})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(x,{children:[e.jsxs(f,{children:[e.jsx(h,{children:"Progresso da Coleta"}),e.jsx(C,{children:"Vínculos empregatícios coletados"})]}),e.jsx(g,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Progresso"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[v.completed,"/",v.total]})]}),e.jsx(ce,{value:v.percentage,className:"w-full"}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[Math.round(v.percentage),"%"]}),e.jsx("p",{className:"text-sm text-gray-600",children:v.status})]}),e.jsx(b,{href:`/cases/${a.id}/vinculos`,children:e.jsx(c,{variant:"outline",size:"sm",className:"w-full",children:"Gerenciar Vínculos"})})]})})]}),e.jsxs(x,{children:[e.jsxs(f,{children:[e.jsxs(h,{children:["Documentos (",E.length,")"]}),e.jsx(C,{children:"Faça upload de documentos relacionados ao caso"})]}),e.jsx(g,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:`rounded-lg border-2 border-dashed p-6 text-center transition-colors ${A?"border-blue-400 bg-blue-50":"border-gray-300 hover:border-gray-400"}`,onDragEnter:R,onDragLeave:R,onDragOver:R,onDrop:Q,children:[e.jsx("input",{ref:O,type:"file",multiple:!0,onChange:Y,className:"hidden",accept:".pdf,.doc,.docx,.jpg,.jpeg,.png"}),e.jsx(we,{className:`mx-auto mb-2 h-8 w-8 ${A?"text-blue-500":"text-gray-400"}`}),e.jsx("p",{className:"mb-2 text-sm text-gray-600",children:A?"Solte os arquivos aqui":"Arraste e solte arquivos aqui ou clique para selecionar"}),e.jsx(c,{variant:"outline",onClick:()=>{var s;return(s=O.current)==null?void 0:s.click()},disabled:F,children:F?"Enviando...":"Selecionar Arquivos"})]}),E.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Documentos Enviados:"}),E.map(s=>e.jsxs("div",{className:"flex items-center justify-between rounded border p-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:s.file_name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[ee(s.file_size)," • ",new Date(s.created_at).toLocaleDateString("pt-BR")]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>window.open(`/documents/${s.id}/download`,"_blank"),children:e.jsx(Se,{className:"h-4 w-4"})}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>Z(s.id),className:"text-red-500 hover:text-red-700",children:e.jsx(je,{className:"h-4 w-4"})})]})]},s.id))]}),e.jsx(b,{href:`/documents/case/${a.id}`,children:e.jsx(c,{variant:"outline",className:"w-full",children:"Ver Todos os Documentos"})})]})})]})]})]})]})]})}export{Ge as default};
