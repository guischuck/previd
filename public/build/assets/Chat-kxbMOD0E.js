import{r,j as e,Q as T}from"./app-ByIhTPwz.js";import{B as C}from"./button-D42JWFCD.js";import{I as S}from"./input-BCJ9LsRF.js";import{A as R}from"./app-layout-Bpm5aqBZ.js";/* empty css            */import"./index-B0bzsaPC.js";import"./index-BQV6tv38.js";import"./app-logo-icon-BU8CUpKl.js";const $=m=>m.replace(/\*\*(.*?)\*\*/g,'<strong class="text-black dark:text-white">$1</strong>').replace(new RegExp("(?<!\\*)\\*([^*]+?)\\*(?!\\*)","g"),'<em class="text-black dark:text-white">$1</em>').replace(/^- (.+)$/gm,'<li class="ml-4 list-disc text-black dark:text-white">$1</li>').replace(/^\d+\. (.+)$/gm,'<li class="ml-4 list-decimal text-black dark:text-white">$1</li>').replace(/((?:<li class="ml-4 list-disc.*?<\/li>\s*)+)/gs,'<ul class="list-disc ml-4 space-y-1 text-black dark:text-white">$1</ul>').replace(/((?:<li class="ml-4 list-decimal.*?<\/li>\s*)+)/gs,'<ol class="list-decimal ml-4 space-y-1 text-black dark:text-white">$1</ol>').replace(/\n\n/g,'</p><p class="mb-2 text-black dark:text-white">').replace(/\n/g,"<br />").replace(/^(?!<[uo]l|<li|<p)/gm,'<p class="mb-2 text-black dark:text-white">').replace(/([^>])$/g,"$1</p>");function D(){const[m,f]=r.useState([]),[u,b]=r.useState(""),[l,g]=r.useState(null),[x,i]=r.useState([]),[w,j]=r.useState(!1),[o,h]=r.useState(""),[p,v]=r.useState(!1),k=r.useRef(null),y=r.useRef(null);r.useEffect(()=>{var a;const t=(a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.getAttribute("content");fetch("/api/clients",{credentials:"include",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":t||""}}).then(s=>{if(!s.ok)throw new Error("Erro ao buscar clientes");return s.json()}).then(s=>{console.log("Clientes carregados:",s),f(s)}).catch(s=>{console.error("Erro ao carregar clientes:",s),f([])})},[]),r.useEffect(()=>{(async()=>{var a;if(!l){i([]);return}j(!0);try{const s=(a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.getAttribute("content"),n=await fetch(`/api/chat-messages?case_id=${l.id}`,{credentials:"include",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":s||""}});if(!n.ok)throw new Error("Erro ao carregar histÃ³rico");const d=await n.json();i(d.map(c=>({sender:c.sender==="assistant"?"chatgpt":"user",text:c.content})))}catch(s){console.error("Erro ao carregar histÃ³rico:",s)}finally{j(!1)}})()},[l]);const N=(()=>{if(!u.trim())return[];const t=u.toLowerCase().trim();return m.filter(a=>(a.name||"").toLowerCase().includes(t))})();r.useEffect(()=>{var t;(t=k.current)==null||t.scrollIntoView({behavior:"smooth"})},[x]);const E=async()=>{var a;if(!o.trim())return;i(s=>[...s,{sender:"user",text:o}]);const t=o;h(""),v(!0);try{const s=(a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.getAttribute("content"),n=await fetch("/api/ai-chat",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":s||""},credentials:"include",body:JSON.stringify({client_id:(l==null?void 0:l.id)||null,message:t})});if(!n.ok)throw new Error(`Erro HTTP: ${n.status}`);const d=await n.json();d.success?i(c=>[...c,{sender:"chatgpt",text:d.response||"Sem resposta."}]):i(c=>[...c,{sender:"chatgpt",text:d.response||"Erro ao processar mensagem."}])}catch(s){console.error("Erro no chat:",s),i(n=>[...n,{sender:"chatgpt",text:"Erro ao conectar com o servidor. Verifique sua conexÃ£o e tente novamente."}])}v(!1)},_=t=>{t.key==="Enter"&&E()};return r.useEffect(()=>{var t;i([]),h(""),(t=y.current)==null||t.focus()},[l]),e.jsxs(R,{children:[e.jsx(T,{title:"Chat com ChatGPT"}),e.jsxs("div",{className:"flex h-full w-full flex-col overflow-hidden bg-background",children:[e.jsxs("div",{className:"flex flex-col gap-2 border-b bg-muted/50 px-2 py-3 md:px-6 md:py-4",children:[e.jsx("div",{className:"text-lg font-semibold text-foreground",children:"Chat com ChatGPT"}),l?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-blue-600 dark:text-blue-400",children:l.name}),e.jsx(C,{size:"sm",variant:"outline",onClick:()=>g(null),children:"Trocar cliente"})]}):e.jsxs("div",{className:"relative",children:[e.jsx(S,{placeholder:"Busque o cliente pelo nome...",value:u,onChange:t=>b(t.target.value),className:"pr-2",autoFocus:!0}),u.trim()&&N.length>0&&e.jsx("div",{className:"absolute top-full right-0 left-0 z-10 max-h-48 overflow-y-auto rounded-md border bg-background shadow-lg",children:N.map(t=>e.jsx("button",{className:"w-full border-b px-3 py-2 text-left text-foreground last:border-b-0 hover:bg-muted",onClick:()=>{g(t),b("")},children:t.name},t.id))})]})]}),e.jsxs("div",{className:"flex min-h-[300px] flex-1 flex-col overflow-y-auto bg-muted/30 px-1 py-2 md:px-6 md:py-4",children:[!w&&x.length===0?e.jsx("div",{className:"flex min-h-[60vh] w-full flex-1 items-center justify-center",children:e.jsxs("div",{className:"mx-2 flex w-full max-w-xl flex-col items-center gap-4 rounded-xl border bg-card p-4 shadow-lg md:p-8 [&_*]:text-black [&_*]:dark:text-white",children:[e.jsx("div",{className:"mb-2 rounded-full bg-blue-100 p-3 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{fill:"currentColor",d:"M12 2a10 10 0 1 0 10 10A10.011 10.011 0 0 0 12 2Zm0 18.75A8.75 8.75 0 1 1 20.75 12 8.76 8.76 0 0 1 12 20.75Zm0-13.5a1.25 1.25 0 1 1-1.25 1.25A1.25 1.25 0 0 1 12 7.25Zm1.25 8.5a1.25 1.25 0 0 1-2.5 0v-3.5a1.25 1.25 0 0 1 2.5 0Z"})})}),e.jsx("div",{className:"text-center text-lg font-semibold",children:"OlÃ¡! Sou sua assistente previdenciÃ¡ria especializada. Posso ajudar com:"}),e.jsxs("ul",{className:"mx-auto w-full max-w-xs list-disc space-y-1 pl-5 text-left text-base",children:[e.jsx("li",{children:"AnÃ¡lise de casos previdenciÃ¡rios"}),e.jsx("li",{children:"InterpretaÃ§Ã£o de documentos CNIS"}),e.jsx("li",{children:"EstratÃ©gias para benefÃ­cios"}),e.jsx("li",{children:"DÃºvidas sobre vÃ­nculos empregatÃ­cios"}),e.jsx("li",{children:"OrientaÃ§Ãµes sobre coleta de documentos"})]}),e.jsxs("div",{className:"mt-2 w-full text-center text-sm",children:[e.jsx("b",{children:"ðŸ’¡ Dica:"})," Use a busca acima para selecionar um cliente e obter respostas mais precisas!"]})]})}):w?e.jsx("div",{className:"flex min-h-[60vh] w-full flex-1 items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-600"})}):x.map((t,a)=>e.jsx("div",{className:`flex ${t.sender==="user"?"justify-end":"justify-start"} mb-2 w-full`,children:e.jsx("div",{className:`max-w-[95vw] rounded-xl px-4 py-2 shadow-sm md:max-w-[75%] ${t.sender==="user"?"rounded-br-none bg-blue-600 text-white [&_*]:text-white":"rounded-bl-none border bg-blue-600 text-white [&_*]:text-white"}`,children:t.sender==="chatgpt"?e.jsx("div",{className:"markdown-content text-white [&>*]:text-white [&_a]:text-white [&_code]:bg-blue-700 [&_code]:text-white [&_em]:text-white [&_li]:text-white [&_p]:text-white [&_pre]:bg-blue-700 [&_pre]:text-white [&_span]:text-white [&_strong]:text-white [&_table]:text-white [&_td]:text-white [&_th]:text-white [&_tr]:text-white",dangerouslySetInnerHTML:{__html:$(t.text)}}):e.jsx("div",{className:"whitespace-pre-wrap",children:t.text})})},a)),e.jsx("div",{ref:k})]}),e.jsxs("div",{className:"flex gap-2 border-t bg-background px-1 py-3 md:px-6 md:py-4",children:[e.jsx(S,{ref:y,value:o,onChange:t=>h(t.target.value),onKeyDown:_,placeholder:"Digite sua mensagem...",disabled:p,className:"min-w-0 flex-1",autoFocus:!0}),e.jsx(C,{onClick:E,disabled:!o.trim()||p,className:"shrink-0",children:p?"Enviando...":"Enviar"})]})]})]})}export{D as default};
