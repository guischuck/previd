import{x as G,r as l,j as e,Q as W,t as Y}from"./app-WLgdctHE.js";import{a as Z,B as u}from"./button-C_hdWeJT.js";import{C,b,c as y,d as V,a as _}from"./card-B9ABilfG.js";import{I as p}from"./input-xcfB5pT_.js";import{L as i}from"./label-DW13EDec.js";import{P as ee}from"./progress-DqiWOS7n.js";import{S as se,a as ae,b as re,c as te,d as ce}from"./select-Ctv1h0M_.js";import{T as ne}from"./textarea-BONqJJPl.js";import{A as ie,F as T}from"./app-layout-DMq6fKxE.js";import{A as oe}from"./arrow-left-CwlDV6Yj.js";import{U as q}from"./upload-Bvl8pOya.js";import{L as S}from"./loader-circle-BlgnF-Qf.js";import{C as le}from"./circle-alert-BaQQqpJU.js";import{U as de}from"./user-Co5FF7Dd.js";import{P as me}from"./plus-BIQDYzjL.js";import{C as pe}from"./circle-check-big-6MDnwIIt.js";/* empty css            */import"./index-BND9CRu0.js";import"./index-AgoEjcBu.js";import"./index-xBcEKAQ3.js";import"./chevron-up-Bep2Q40x.js";import"./app-logo-icon-OCgv-Ije.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],ue=Z("CircleCheck",xe);function Le({benefitTypes:L}){var P;const{data:t,setData:c,post:O,processing:D,errors:n}=G({client_name:"",client_cpf:"",benefit_type:"",notes:"",vinculos_empregaticios:[]}),[d,w]=l.useState(null),[j,f]=l.useState(null),[h,F]=l.useState(!1),[U,v]=l.useState(0),[k,x]=l.useState(null),[B,N]=l.useState(!1),A=l.useRef(null),R=[{title:"Casos",href:"/cases"},{title:"Novo Caso",href:"#"}],z=s=>{s.preventDefault(),N(!0)},J=s=>{s.preventDefault(),N(!1)},I=s=>{s.preventDefault(),N(!1);const a=s.dataTransfer.files;a.length>0&&a[0].type==="application/pdf"&&(w(a[0]),f(null),x(null))},M=s=>{var r;const a=(r=s.target.files)==null?void 0:r[0];a&&a.type==="application/pdf"&&(w(a),f(null),x(null))},Q=()=>{var s;(s=A.current)==null||s.click()},H=async()=>{var a;if(!d)return;F(!0),v(0),x(null);const s=setInterval(()=>{v(r=>r>=90?r:r+Math.random()*15)},200);try{const r=new FormData;r.append("cnis_file",d);const o=await(await fetch("/api/process-cnis",{method:"POST",body:r,headers:{"X-CSRF-TOKEN":((a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.getAttribute("content"))||""}})).json();o.success&&o.data?(f(o.data),c({...t,client_name:o.data.client_name||"",client_cpf:o.data.client_cpf||"",vinculos_empregaticios:o.data.vinculos_empregaticios||[]}),v(100)):x(o.error||"Erro ao processar o arquivo CNIS")}catch{x("Erro de conexão. Tente novamente.")}finally{clearInterval(s),F(!1)}},K=s=>{s.preventDefault(),console.log("Enviando dados:",t),O("/cases",{onSuccess:()=>{console.log("Caso criado com sucesso!")},onError:a=>{console.error("Erro ao criar caso:",a)}})},X=()=>{const s={empregador:"",cnpj:"",data_inicio:"",data_fim:""},a=Array.isArray(t.vinculos_empregaticios)?t.vinculos_empregaticios:[];c("vinculos_empregaticios",[...a,s])},g=(s,a,r)=>{const m=[...Array.isArray(t.vinculos_empregaticios)?t.vinculos_empregaticios:[]];m[s]={...m[s],[a]:r},c("vinculos_empregaticios",m)},$=s=>{const a=(Array.isArray(t.vinculos_empregaticios)?t.vinculos_empregaticios:[]).filter((r,m)=>m!==s);c("vinculos_empregaticios",a)},E=Array.isArray(t.vinculos_empregaticios)?t.vinculos_empregaticios:[];return e.jsxs(ie,{breadcrumbs:R,children:[e.jsx(W,{title:"Novo Caso - Sistema Jurídico"}),e.jsx("div",{className:"container mx-auto px-6 py-8",children:e.jsxs("div",{className:"mx-auto max-w-4xl",children:[e.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Criar Novo Caso"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"Faça upload do CNIS ou preencha manualmente os dados do cliente"})]}),e.jsx(Y,{href:"/cases",children:e.jsxs(u,{variant:"outline",className:"gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),"Voltar"]})})]}),e.jsxs("div",{className:"grid gap-8",children:[e.jsxs(C,{children:[e.jsxs(b,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"}),"Upload do CNIS (Opcional)"]}),e.jsx(V,{children:"Faça upload do arquivo PDF do CNIS para extração automática dos dados"})]}),e.jsxs(_,{className:"space-y-6",children:[e.jsxs("div",{className:`relative cursor-pointer rounded-xl border-2 border-dashed p-8 text-center transition-all duration-300 ${B?"border-blue-500 bg-blue-50 dark:bg-blue-950/30":d?"border-green-500 bg-green-50 dark:bg-green-950/30":"border-gray-300 hover:border-gray-400"}`,onClick:Q,onDragEnter:z,onDragLeave:J,onDragOver:I,onDrop:I,children:[e.jsx("input",{ref:A,type:"file",accept:".pdf",onChange:M,className:"hidden"}),d?e.jsxs("div",{className:"space-y-4",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-600",children:[e.jsx(T,{className:"h-8 w-8"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:d.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(d.size/1024/1024).toFixed(2)," MB"]})]})]}),!h&&!j&&e.jsx(u,{onClick:s=>{s.stopPropagation(),H()},disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"mr-2 h-4 w-4 animate-spin"}),"Processando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"Extrair Dados"]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(q,{className:"mx-auto h-12 w-12 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Arraste o arquivo CNIS aqui"}),e.jsx("p",{className:"text-muted-foreground",children:"ou clique para selecionar (apenas PDF)"})]})]})]}),h&&e.jsxs("div",{className:"space-y-3 rounded-lg bg-blue-50 p-4 dark:bg-blue-950/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"text-sm font-medium",children:"Processando arquivo CNIS..."})]}),e.jsx(ee,{value:U,className:"h-2"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Extraindo dados do cliente e vínculos empregatícios"})]}),k&&e.jsxs("div",{className:"rounded-lg bg-red-50 p-4 dark:bg-red-950/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4 text-red-500"}),e.jsx("p",{className:"font-medium text-red-800 dark:text-red-200",children:"Erro no processamento"})]}),e.jsx("p",{className:"mt-1 text-sm text-red-700 dark:text-red-300",children:k})]}),j&&e.jsx("div",{className:"rounded-lg bg-green-50 p-4 dark:bg-green-950/30",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4 text-green-500"}),e.jsx("p",{className:"font-medium text-green-800 dark:text-green-200",children:"Dados extraídos com sucesso!"}),e.jsxs("p",{className:"mt-1 text-sm text-green-700 dark:text-green-300",children:[((P=j.vinculos_empregaticios)==null?void 0:P.length)||0," vínculos encontrados"]})]})})]})]}),e.jsxs("form",{onSubmit:K,className:"space-y-8",children:[e.jsxs(C,{children:[e.jsx(b,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-5 w-5"}),"Dados do Cliente"]})}),e.jsxs(_,{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"client_name",children:"Nome Completo *"}),e.jsx(p,{id:"client_name",value:String(t.client_name||""),onChange:s=>c("client_name",s.target.value),placeholder:"Digite o nome completo do cliente",required:!0}),n.client_name&&e.jsx("p",{className:"text-sm text-red-600",children:n.client_name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"client_cpf",children:"CPF *"}),e.jsx(p,{id:"client_cpf",value:String(t.client_cpf||""),onChange:s=>c("client_cpf",s.target.value),placeholder:"000.000.000-00",required:!0}),n.client_cpf&&e.jsx("p",{className:"text-sm text-red-600",children:n.client_cpf})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"benefit_type",children:"Tipo de Benefício"}),e.jsxs(se,{value:t.benefit_type,onValueChange:s=>c("benefit_type",s),children:[e.jsx(ae,{children:e.jsx(re,{placeholder:"Selecione o tipo de benefício"})}),e.jsx(te,{children:Object.entries(L).map(([s,a])=>e.jsx(ce,{value:s,children:a},s))})]}),n.benefit_type&&e.jsx("p",{className:"text-sm text-red-600",children:n.benefit_type})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(i,{htmlFor:"notes",children:"Observações"}),e.jsx(ne,{id:"notes",value:t.notes,onChange:s=>c("notes",s.target.value),placeholder:"Observações adicionais sobre o caso...",rows:4}),n.notes&&e.jsx("p",{className:"text-sm text-red-600",children:n.notes})]})]})]}),e.jsxs(C,{children:[e.jsxs(b,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(y,{children:"Vínculos Empregatícios"}),e.jsxs(u,{type:"button",variant:"outline",size:"sm",onClick:X,children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),"Adicionar Vínculo"]})]}),e.jsx(V,{children:"Adicione os vínculos empregatícios do cliente. Estes dados podem ser extraídos automaticamente do CNIS."})]}),e.jsx(_,{children:E.length===0?e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx("p",{children:"Nenhum vínculo empregatício adicionado."}),e.jsx("p",{children:"Faça upload do CNIS ou adicione manualmente."})]}):e.jsx("div",{className:"space-y-6",children:E.map((s,a)=>e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsxs("h4",{className:"font-medium",children:["Vínculo ",a+1]}),e.jsx(u,{type:"button",variant:"ghost",size:"sm",onClick:()=>$(a),className:"text-red-600 hover:text-red-700",children:"Remover"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Empregador"}),e.jsx(p,{value:s.empregador,onChange:r=>g(a,"empregador",r.target.value),placeholder:"Nome da empresa"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"CNPJ"}),e.jsx(p,{value:s.cnpj,onChange:r=>g(a,"cnpj",r.target.value),placeholder:"00.000.000/0000-00"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Data de Início"}),e.jsx(p,{value:s.data_inicio,onChange:r=>g(a,"data_inicio",r.target.value),placeholder:"dd/mm/aaaa"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Data de Fim"}),e.jsx(p,{value:s.data_fim,onChange:r=>g(a,"data_fim",r.target.value),placeholder:"dd/mm/aaaa ou deixe em branco se ativo"})]})]})]},a))})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(u,{type:"submit",disabled:D,className:"min-w-32",children:D?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-4 w-4 animate-spin"}),"Criando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"h-4 w-4"}),"Criar Caso"]})})})]})]})]})})]})}export{Le as default};
