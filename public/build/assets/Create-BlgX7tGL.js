import{x as G,r as l,j as e,Q as W,t as Y}from"./app-BLxXbY_b.js";import{a as Z,B as x}from"./button-DT3cAopr.js";import{C as N,b as C,c as b,d as P,a as y}from"./card-DXsYbZZ8.js";import{I as p}from"./input-B6-kdMEW.js";import{L as i}from"./label-DhHCYi2m.js";import{P as ee}from"./progress-D5ZrSgqH.js";import{S as se,a as ae,b as re,c as te,d as ce}from"./select-PIBy2OK5.js";import{T as ne}from"./textarea-B3ufgyOM.js";import{A as ie,F as V}from"./app-layout-G5Onjp1f.js";import{A as oe}from"./arrow-left-DkkcmHkS.js";import{U as T}from"./upload-BMeS_ONa.js";import{L as _}from"./loader-circle-C9Ezfimq.js";import{C as le}from"./circle-alert-4k1SCI3A.js";import{U as de}from"./user-XLy2po4n.js";import{P as me}from"./plus-r_jTQZqR.js";import{C as pe}from"./circle-check-big-BXhRoDc7.js";/* empty css            */import"./index-Ci0KITsv.js";import"./index-6jQRo-49.js";import"./index-CpqCA5-U.js";import"./chevron-up-B9Jrt4ee.js";import"./app-logo-icon-DgzmCoEH.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],ue=Z("CircleCheck",xe);function Le({benefitTypes:q}){var E;const{data:t,setData:c,post:L,processing:S,errors:n}=G({client_name:"",client_cpf:"",benefit_type:"",notes:"",vinculos_empregaticios:[]}),[d,D]=l.useState(null),[j,O]=l.useState(null),[u,w]=l.useState(!1),[U,g]=l.useState(0),[F,f]=l.useState(null),[B,v]=l.useState(!1),k=l.useRef(null),R=[{title:"Casos",href:"/cases"},{title:"Novo Caso",href:"#"}],z=s=>{s.preventDefault(),v(!0)},J=s=>{s.preventDefault(),v(!1)},A=s=>{s.preventDefault(),v(!1);const a=s.dataTransfer.files;a.length>0&&a[0].type==="application/pdf"&&D(a[0])},M=s=>{var r;const a=(r=s.target.files)==null?void 0:r[0];a&&a.type==="application/pdf"&&D(a)},Q=()=>{var s;(s=k.current)==null||s.click()},H=async()=>{var a;if(!d)return;w(!0),g(0),f(null);const s=setInterval(()=>{g(r=>r>=90?r:r+Math.random()*15)},200);try{const r=new FormData;r.append("cnis_file",d);const o=await(await fetch("/api/process-cnis",{method:"POST",body:r,headers:{"X-CSRF-TOKEN":((a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.getAttribute("content"))||""}})).json();o.success&&o.data?(O(o.data),c({...t,client_name:o.data.client_name||"",client_cpf:o.data.client_cpf||"",vinculos_empregaticios:o.data.vinculos_empregaticios||[]}),g(100)):f(o.error||"Erro ao processar o arquivo CNIS")}catch{f("Erro de conexão. Tente novamente.")}finally{clearInterval(s),w(!1)}},K=s=>{s.preventDefault(),console.log("Enviando dados:",t),L("/cases",{onSuccess:()=>{console.log("Caso criado com sucesso!")},onError:a=>{console.error("Erro ao criar caso:",a)}})},X=()=>{const s={empregador:"",cnpj:"",data_inicio:"",data_fim:""},a=Array.isArray(t.vinculos_empregaticios)?t.vinculos_empregaticios:[];c("vinculos_empregaticios",[...a,s])},h=(s,a,r)=>{const m=[...Array.isArray(t.vinculos_empregaticios)?t.vinculos_empregaticios:[]];m[s]={...m[s],[a]:r},c("vinculos_empregaticios",m)},$=s=>{const a=(Array.isArray(t.vinculos_empregaticios)?t.vinculos_empregaticios:[]).filter((r,m)=>m!==s);c("vinculos_empregaticios",a)},I=Array.isArray(t.vinculos_empregaticios)?t.vinculos_empregaticios:[];return e.jsxs(ie,{breadcrumbs:R,children:[e.jsx(W,{title:"Novo Caso - Sistema Jurídico"}),e.jsx("div",{className:"container mx-auto px-6 py-8",children:e.jsxs("div",{className:"mx-auto max-w-4xl",children:[e.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Criar Novo Caso"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"Faça upload do CNIS ou preencha manualmente os dados do cliente"})]}),e.jsx(Y,{href:"/cases",children:e.jsxs(x,{variant:"outline",className:"gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),"Voltar"]})})]}),e.jsxs("div",{className:"grid gap-8",children:[e.jsxs(N,{children:[e.jsxs(C,{children:[e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5"}),"Upload do CNIS (Opcional)"]}),e.jsx(P,{children:"Faça upload do arquivo PDF do CNIS para extração automática dos dados"})]}),e.jsxs(y,{className:"space-y-6",children:[e.jsxs("div",{className:`relative cursor-pointer rounded-xl border-2 border-dashed p-8 text-center transition-all duration-300 ${B?"border-blue-500 bg-blue-50 dark:bg-blue-950/30":d?"border-green-500 bg-green-50 dark:bg-green-950/30":"border-gray-300 hover:border-gray-400"}`,onClick:Q,onDragEnter:z,onDragLeave:J,onDragOver:A,onDrop:A,children:[e.jsx("input",{ref:k,type:"file",accept:".pdf",onChange:M,className:"hidden"}),d?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-600",children:[e.jsx(V,{className:"h-8 w-8"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:d.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(d.size/1024/1024).toFixed(2)," MB"]})]})]}),!u&&!j&&e.jsx(x,{onClick:H,disabled:u,children:u?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"mr-2 h-4 w-4 animate-spin"}),"Processando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"mr-2 h-4 w-4"}),"Extrair Dados"]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(T,{className:"mx-auto h-12 w-12 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Arraste o arquivo CNIS aqui"}),e.jsx("p",{className:"text-muted-foreground",children:"ou clique para selecionar (apenas PDF)"})]})]})]}),u&&e.jsxs("div",{className:"space-y-3 rounded-lg bg-blue-50 p-4 dark:bg-blue-950/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"text-sm font-medium",children:"Processando arquivo CNIS..."})]}),e.jsx(ee,{value:U,className:"h-2"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Extraindo dados do cliente e vínculos empregatícios"})]}),F&&e.jsxs("div",{className:"rounded-lg bg-red-50 p-4 dark:bg-red-950/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4 text-red-500"}),e.jsx("p",{className:"font-medium text-red-800 dark:text-red-200",children:"Erro no processamento"})]}),e.jsx("p",{className:"mt-1 text-sm text-red-700 dark:text-red-300",children:F})]}),j&&e.jsx("div",{className:"rounded-lg bg-green-50 p-4 dark:bg-green-950/30",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4 text-green-500"}),e.jsx("p",{className:"font-medium text-green-800 dark:text-green-200",children:"Dados extraídos com sucesso!"}),e.jsxs("p",{className:"mt-1 text-sm text-green-700 dark:text-green-300",children:[((E=j.vinculos_empregaticios)==null?void 0:E.length)||0," vínculos encontrados"]})]})})]})]}),e.jsxs("form",{onSubmit:K,className:"space-y-8",children:[e.jsxs(N,{children:[e.jsx(C,{children:e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-5 w-5"}),"Dados do Cliente"]})}),e.jsxs(y,{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"client_name",children:"Nome Completo *"}),e.jsx(p,{id:"client_name",value:String(t.client_name||""),onChange:s=>c("client_name",s.target.value),placeholder:"Digite o nome completo do cliente",required:!0}),n.client_name&&e.jsx("p",{className:"text-sm text-red-600",children:n.client_name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"client_cpf",children:"CPF *"}),e.jsx(p,{id:"client_cpf",value:String(t.client_cpf||""),onChange:s=>c("client_cpf",s.target.value),placeholder:"000.000.000-00",required:!0}),n.client_cpf&&e.jsx("p",{className:"text-sm text-red-600",children:n.client_cpf})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"benefit_type",children:"Tipo de Benefício"}),e.jsxs(se,{value:t.benefit_type,onValueChange:s=>c("benefit_type",s),children:[e.jsx(ae,{children:e.jsx(re,{placeholder:"Selecione o tipo de benefício"})}),e.jsx(te,{children:Object.entries(q).map(([s,a])=>e.jsx(ce,{value:s,children:a},s))})]}),n.benefit_type&&e.jsx("p",{className:"text-sm text-red-600",children:n.benefit_type})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(i,{htmlFor:"notes",children:"Observações"}),e.jsx(ne,{id:"notes",value:t.notes,onChange:s=>c("notes",s.target.value),placeholder:"Observações adicionais sobre o caso...",rows:4}),n.notes&&e.jsx("p",{className:"text-sm text-red-600",children:n.notes})]})]})]}),e.jsxs(N,{children:[e.jsxs(C,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(b,{children:"Vínculos Empregatícios"}),e.jsxs(x,{type:"button",variant:"outline",size:"sm",onClick:X,children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),"Adicionar Vínculo"]})]}),e.jsx(P,{children:"Adicione os vínculos empregatícios do cliente. Estes dados podem ser extraídos automaticamente do CNIS."})]}),e.jsx(y,{children:I.length===0?e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx("p",{children:"Nenhum vínculo empregatício adicionado."}),e.jsx("p",{children:"Faça upload do CNIS ou adicione manualmente."})]}):e.jsx("div",{className:"space-y-6",children:I.map((s,a)=>e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsxs("h4",{className:"font-medium",children:["Vínculo ",a+1]}),e.jsx(x,{type:"button",variant:"ghost",size:"sm",onClick:()=>$(a),className:"text-red-600 hover:text-red-700",children:"Remover"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Empregador"}),e.jsx(p,{value:s.empregador,onChange:r=>h(a,"empregador",r.target.value),placeholder:"Nome da empresa"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"CNPJ"}),e.jsx(p,{value:s.cnpj,onChange:r=>h(a,"cnpj",r.target.value),placeholder:"00.000.000/0000-00"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Data de Início"}),e.jsx(p,{value:s.data_inicio,onChange:r=>h(a,"data_inicio",r.target.value),placeholder:"dd/mm/aaaa"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Data de Fim"}),e.jsx(p,{value:s.data_fim,onChange:r=>h(a,"data_fim",r.target.value),placeholder:"dd/mm/aaaa ou deixe em branco se ativo"})]})]})]},a))})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(x,{type:"submit",disabled:S,className:"min-w-32",children:S?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"h-4 w-4 animate-spin"}),"Criando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"h-4 w-4"}),"Criar Caso"]})})})]})]})]})})]})}export{Le as default};
