import{r as a,j as e,Q as $}from"./app-WLgdctHE.js";import{B as C}from"./button-C_hdWeJT.js";import{I as S}from"./input-xcfB5pT_.js";import{A as I}from"./app-layout-DMq6fKxE.js";/* empty css            */import"./index-AgoEjcBu.js";import"./index-BND9CRu0.js";import"./app-logo-icon-OCgv-Ije.js";const A=()=>e.jsx("div",{className:"flex justify-start mb-3 w-full",children:e.jsx("div",{className:"max-w-[95vw] rounded-2xl px-4 py-3 shadow-md md:max-w-[75%] rounded-bl-md bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-100 border border-slate-200 dark:border-slate-600 shadow-slate-200 dark:shadow-slate-900/20",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"text-slate-500 dark:text-slate-400 text-sm",children:"IA estÃ¡ digitando"}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})]})})}),q=x=>x.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(new RegExp("(?<!\\*)\\*([^*]+?)\\*(?!\\*)","g"),"<em>$1</em>").replace(/^- (.+)$/gm,'<li class="ml-4 list-disc">$1</li>').replace(/^\d+\. (.+)$/gm,'<li class="ml-4 list-decimal">$1</li>').replace(/((?:<li class="ml-4 list-disc.*?<\/li>\s*)+)/gs,'<ul class="list-disc ml-4 space-y-1 my-2">$1</ul>').replace(/((?:<li class="ml-4 list-decimal.*?<\/li>\s*)+)/gs,'<ol class="list-decimal ml-4 space-y-1 my-2">$1</ol>').replace(/\n\n/g,'</p><p class="mb-2">').replace(/\n/g,"<br />").replace(/^(?!<[uo]l|<li|<p)/gm,'<p class="mb-2">').replace(/([^>])$/g,"$1</p>");function P(){const[x,g]=a.useState([]),[m,b]=a.useState(""),[o,w]=a.useState(null),[u,d]=a.useState([]),[j,k]=a.useState(!1),[c,p]=a.useState(""),[h,v]=a.useState(!1),[T,f]=a.useState(!1),y=a.useRef(null),N=a.useRef(null);a.useEffect(()=>{var l;const t=(l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.getAttribute("content");fetch("/api/clients",{credentials:"include",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":t||""}}).then(s=>{if(!s.ok)throw new Error("Erro ao buscar clientes");return s.json()}).then(s=>{console.log("Clientes carregados:",s),g(s)}).catch(s=>{console.error("Erro ao carregar clientes:",s),g([])})},[]),a.useEffect(()=>{(async()=>{var l;if(!o){d([]);return}k(!0);try{const s=(l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.getAttribute("content");console.log("Carregando histÃ³rico para case_id:",o.id);const r=await fetch(`/api/chat-messages?case_id=${o.id}`,{credentials:"include",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":s||"",Accept:"application/json"}});if(console.log("Response status:",r.status),console.log("Response headers:",Object.fromEntries(r.headers.entries())),!r.ok){const n=await r.text();throw console.error("Erro na resposta:",r.status,n),new Error(`Erro ao carregar histÃ³rico: ${r.status}`)}const i=await r.json();console.log("HistÃ³rico carregado:",i),d(i.map(n=>({sender:n.sender==="assistant"?"chatgpt":"user",text:n.content})))}catch(s){console.error("Erro ao carregar histÃ³rico:",s)}finally{k(!1)}})()},[o]);const _=(()=>{if(!m.trim())return[];const t=m.toLowerCase().trim();return x.filter(l=>(l.name||"").toLowerCase().includes(t))})();a.useEffect(()=>{var t;(t=y.current)==null||t.scrollIntoView({behavior:"smooth"})},[u]);const E=async()=>{var l;if(!c.trim())return;d(s=>[...s,{sender:"user",text:c}]);const t=c;p(""),v(!0),f(!0);try{const s=(l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.getAttribute("content"),r=await fetch("/api/ai-chat",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":s||""},credentials:"include",body:JSON.stringify({client_id:(o==null?void 0:o.id)||null,message:t})});if(!r.ok)throw new Error(`Erro HTTP: ${r.status}`);const i=await r.json();i.success?d(n=>[...n,{sender:"chatgpt",text:i.response||"Sem resposta."}]):d(n=>[...n,{sender:"chatgpt",text:i.response||"Erro ao processar mensagem."}])}catch(s){console.error("Erro no chat:",s),d(r=>[...r,{sender:"chatgpt",text:"Erro ao conectar com o servidor. Verifique sua conexÃ£o e tente novamente."}])}v(!1),f(!1)},R=t=>{t.key==="Enter"&&E()};return a.useEffect(()=>{var t;p(""),f(!1),(t=N.current)==null||t.focus()},[o]),e.jsxs(I,{children:[e.jsx($,{title:"Chat com ChatGPT"}),e.jsxs("div",{className:"flex h-full w-full flex-col overflow-hidden bg-background",children:[e.jsxs("div",{className:"flex flex-col gap-2 border-b border-slate-200 dark:border-slate-700 bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm px-2 py-3 md:px-6 md:py-4",children:[e.jsx("div",{className:"text-lg font-semibold text-slate-800 dark:text-slate-200",children:"Chat com IA PrevidenciÃ¡ria"}),o?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-emerald-600 dark:text-emerald-400",children:o.name}),e.jsx(C,{size:"sm",variant:"outline",onClick:()=>w(null),children:"Trocar cliente"})]}):e.jsxs("div",{className:"relative",children:[e.jsx(S,{placeholder:"Busque o cliente pelo nome...",value:m,onChange:t=>b(t.target.value),className:"pr-2",autoFocus:!0}),m.trim()&&_.length>0&&e.jsx("div",{className:"absolute top-full right-0 left-0 z-10 max-h-48 overflow-y-auto rounded-md border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800 shadow-lg",children:_.map(t=>e.jsx("button",{className:"w-full border-b border-slate-100 dark:border-slate-700 px-3 py-2 text-left text-slate-800 dark:text-slate-200 last:border-b-0 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",onClick:()=>{w(t),b("")},children:t.name},t.id))})]})]}),e.jsxs("div",{className:"flex min-h-[300px] flex-1 flex-col overflow-y-auto bg-gradient-to-b from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800 px-1 py-2 md:px-6 md:py-4",children:[!j&&u.length===0?e.jsx("div",{className:"flex min-h-[60vh] w-full flex-1 items-center justify-center",children:e.jsxs("div",{className:"mx-2 flex w-full max-w-xl flex-col items-center gap-4 rounded-xl border bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm p-4 shadow-lg md:p-8",children:[e.jsx("div",{className:"mb-2 rounded-full bg-emerald-100 p-3 text-emerald-600 dark:bg-emerald-900/30 dark:text-emerald-400",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{fill:"currentColor",d:"M12 2a10 10 0 1 0 10 10A10.011 10.011 0 0 0 12 2Zm0 18.75A8.75 8.75 0 1 1 20.75 12 8.76 8.76 0 0 1 12 20.75Zm0-13.5a1.25 1.25 0 1 1-1.25 1.25A1.25 1.25 0 0 1 12 7.25Zm1.25 8.5a1.25 1.25 0 0 1-2.5 0v-3.5a1.25 1.25 0 0 1 2.5 0Z"})})}),e.jsx("div",{className:"text-center text-lg font-semibold text-slate-800 dark:text-slate-200",children:"OlÃ¡! Sou sua assistente previdenciÃ¡ria especializada. Posso ajudar com:"}),e.jsxs("ul",{className:"mx-auto w-full max-w-xs list-disc space-y-1 pl-5 text-left text-base text-slate-700 dark:text-slate-300",children:[e.jsx("li",{children:"AnÃ¡lise de casos previdenciÃ¡rios"}),e.jsx("li",{children:"InterpretaÃ§Ã£o de documentos CNIS"}),e.jsx("li",{children:"EstratÃ©gias para benefÃ­cios"}),e.jsx("li",{children:"DÃºvidas sobre vÃ­nculos empregatÃ­cios"}),e.jsx("li",{children:"OrientaÃ§Ãµes sobre coleta de documentos"})]}),e.jsxs("div",{className:"mt-2 w-full text-center text-sm text-slate-600 dark:text-slate-400",children:[e.jsx("b",{children:"ðŸ’¡ Dica:"})," Use a busca acima para selecionar um cliente e obter respostas mais precisas!"]})]})}):j?e.jsx("div",{className:"flex min-h-[60vh] w-full flex-1 items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-emerald-500"})}):e.jsxs(e.Fragment,{children:[u.map((t,l)=>e.jsx("div",{className:`flex ${t.sender==="user"?"justify-end":"justify-start"} mb-3 w-full`,children:e.jsx("div",{className:`max-w-[95vw] rounded-2xl px-4 py-3 shadow-md md:max-w-[75%] ${t.sender==="user"?"rounded-br-md bg-emerald-500 text-white shadow-emerald-200 dark:shadow-emerald-900/20":"rounded-bl-md bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-100 border border-slate-200 dark:border-slate-600 shadow-slate-200 dark:shadow-slate-900/20"}`,children:t.sender==="chatgpt"?e.jsx("div",{className:"markdown-content prose prose-sm max-w-none text-slate-800 dark:text-slate-100 [&_strong]:text-slate-900 [&_strong]:dark:text-slate-50 [&_em]:text-slate-700 [&_em]:dark:text-slate-200 [&_code]:bg-slate-100 [&_code]:dark:bg-slate-600 [&_code]:text-slate-800 [&_code]:dark:text-slate-200 [&_code]:px-1 [&_code]:py-0.5 [&_code]:rounded [&_pre]:bg-slate-100 [&_pre]:dark:bg-slate-600 [&_pre]:text-slate-800 [&_pre]:dark:text-slate-200 [&_pre]:p-3 [&_pre]:rounded-lg [&_ul]:text-slate-800 [&_ul]:dark:text-slate-100 [&_ol]:text-slate-800 [&_ol]:dark:text-slate-100 [&_li]:text-slate-800 [&_li]:dark:text-slate-100 [&_p]:text-slate-800 [&_p]:dark:text-slate-100",dangerouslySetInnerHTML:{__html:q(t.text)}}):e.jsx("div",{className:"whitespace-pre-wrap text-white",children:t.text})})},l)),T&&e.jsx(A,{})]}),e.jsx("div",{ref:y})]}),e.jsxs("div",{className:"flex gap-2 border-t border-slate-200 dark:border-slate-700 bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm px-1 py-3 md:px-6 md:py-4",children:[e.jsx(S,{ref:N,value:c,onChange:t=>p(t.target.value),onKeyDown:R,placeholder:"Digite sua mensagem...",disabled:h,className:"min-w-0 flex-1",autoFocus:!0}),e.jsx(C,{onClick:E,disabled:!c.trim()||h,className:"shrink-0",children:h?"Enviando...":"Enviar"})]})]})]})}export{P as default};
